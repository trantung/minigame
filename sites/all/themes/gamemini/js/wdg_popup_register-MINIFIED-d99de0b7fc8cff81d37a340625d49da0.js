SpilGames("spilgames.import",{fullName:"PopupRegister",deps:"FormValidation JSLib SWP DOMSelect DOMEvent Placeholder SWPUtils Cookie".split(" "),module:function(t,n,p,h,g,x,e,y){p.init("popup_register");var A=!1,B=!1,a,m={},k=[],r={},H=0,C=!1,w=!1,v=!1,f=function(a){return document.getElementById(a)},E=function(a,c,d){a&&(a.id="hint-sign-"+H++,g.add("#"+a.id,"mouseover",function(){e.hasClass(a,"wrong")||e.removeClass(c,"hidden")}),g.add("#"+a.id,"mouseout",function(){e.addClass(c,"hidden")}));"object"===
typeof d&&d.length||(d=[d]);for(var f=0;f<d.length;f++)g.add("#"+d[f].id,"focus",function(){a&&e.hasClass(a,"wrong")||e.removeClass(c,"hidden")}),g.add("#"+d[f].id,"blur",function(){e.addClass(c,"hidden")})},u=function(b){function c(a){g.add(a,"click",function(a){g.preventDefault(a);var b=l.length;for(a=0;a<b;a++)l[a]===this.parentElement?e.removeClass(l[a],"item-active"):(e.addClass(l[a],"item-active"),e.hasClass(l[a],"email-auth")&&f("popup-register-username").focus())})}var d=f("wdg_popup_register");
d.style.visibility="hidden";e.toggleClass(d,"hidden");b||((B=!e.hasClass(d,"hidden"))?p.Widget.emit("open"):p.Widget.emit("close"));setTimeout(function(){I();if(a.usernameEl){if(a.genderEl)var b=a.genderEl.getAttribute("data-gender-default");a.usernameEl.value="";a.emailEl.value="";a.passwordEl.value="";a.genderBoyEl.checked="boy"===b;a.genderGirlEl.checked="girl"===b;switch(b){case "boy":e.addClass(a.genderBoyEl,"is-checked");e.removeClass(a.genderGirlEl,"is-checked");break;case "girl":e.addClass(a.genderGirlEl,
"is-checked"),e.removeClass(a.genderBoyEl,"is-checked")}g.add("#popup-register-gender-boy + .button","click",function(){e.addClass(a.genderBoyEl,"is-checked");e.removeClass(a.genderGirlEl,"is-checked");a.genderBoyEl.checked=!0;a.genderGirlEl.checked=!1});g.add("#popup-register-gender-girl + .button","click",function(){e.addClass(a.genderGirlEl,"is-checked");e.removeClass(a.genderBoyEl,"is-checked");a.genderGirlEl.checked=!0;a.genderBoyEl.checked=!1});w||(a.dobDayEl.value=-1,a.dobMonthEl.value=-1,
a.dobYearEl.value=-1);a.awtConfirmationEl&&(a.awtConfirmationEl.checked=!1);a.subscribeConfirmationEl&&(a.subscribeConfirmationEl.checked=!1);for(var c in k)"function"===typeof k[c].reset&&k[c].reset();b=h.getAll(a.selectors.popup+" .wrong");for(c=0;c<b.length;c++)e.removeClass(b[c],"wrong");for(error in m)e.addClass(m[error],"hidden");for(hint in r)r[hint].className="tip-sign";/Trident/g.test(window.navigator.userAgent)||(h.get("#"+a.usernameEl.id+"_ph")?g.trigger("#"+a.usernameEl.id+"_ph","keydown"):
a.usernameEl.focus())}d.style.visibility=""},100);var D=h.getAll(".trigger-auth-type"),l=h.getAll(".toggleItem"),q=D.length;for(b=0;b<q;b++)c(D[b])},z=function(b){(a.registerButtonEl.enabled=b)?e.removeClass(a.registerButtonEl,"processsing"):e.addClass(a.registerButtonEl,"processsing")},J=function(){for(var b=h.getAll(a.selectors.popup+" "+a.selectors.tipSign),c=h.getAll(a.selectors.popup+" "+a.selectors.tip+".help"),d=h.getAll(a.selectors.popup+" "+a.selectors.tip+".error"),f=h.get(a.selectors.popup+
" "+a.selectors.tip+".input"),l=null,q=0;q<a.hintedContainers.length;q++)if(l=0<a.hintedContainers[q].getElementsByTagName("input").length?a.hintedContainers[q].getElementsByTagName("input"):a.hintedContainers[q].getElementsByTagName("select"),"popup-register-dob"===a.hintedContainers[q].id)E(null,f,l),e.addClass(f,"hidden");else{var g=b[q]?b[q]:null;if(g&&0<g.getAttribute("title").length){r[g.getAttribute("title")]=g;for(var k=0;k<c.length;k++)e.addClass(c[k],"hidden"),c[k].getAttribute("rel")===
g.getAttribute("title")&&E(g,c[k],l)}}for(b=0;b<d.length;b++)d[b].getAttribute("title")&&(m[d[b].getAttribute("title")]=d[b])},K=function(a){var c=a.error.type,d=a.field,f=a.loading,l=a.extraData,g=document.getElementById("popup-register-"+d);for(error in m)d===error.substr(0,error.indexOf("-"))&&e.addClass(m[error],"hidden");if(a.error){if(m[c]){if(!1===v||d===v)v=d,e.removeClass(m[c],"hidden");l&&"function"==typeof m[c].applyExtraData&&m[c].applyExtraData(l)}r[d]&&(r[d].className="tip-sign wrong");
g&&!e.hasClass(g,"wrong")&&e.addClass(g,"wrong")}else f?r[d].className="tip-sign loading":r[d]&&(r[d].className="tip-sign right"),g&&e.removeClass(g,"wrong"),!0===a.correct&&d===v&&(v=!1);if(l&&"function"==typeof k[d])k[d](l);"dob"===a.field&&!w&&a.error&&"dob-coppa-underage"===a.error.type&&(y.setItem({key:"registrationLocked",value:a.userData.day+"."+(a.userData.month+1)+"."+a.userData.year}),w=!0,F())},L=function(){g.add(f("popup-register-facebook"),"click",function(){G("facebook")});g.add(f("popup-register-google"),
"click",function(){G("google")});g.add(f("register-alreadyuser"),"click",function(a){g.preventDefault(a);u();p.System.emit("popup.login.open",{})})},M=function(){if(a.usernameEl){var b=[{type:"username",elem:a.usernameEl},{type:"email",elem:a.emailEl},{type:"password",elem:a.passwordEl},{type:"dob",elem:{year:a.dobYearEl,month:a.dobMonthEl,day:a.dobDayEl},coppaEnabled:C},{type:"gender",elem:a.genderEl,inputs:[a.genderBoyEl,a.genderGirlEl]}];a.awtConfirmationEl&&b.push({type:"agree-with-terms",elem:a.awtConfirmationEl});
t.attach(b,K)}},N=function(){document.getElementById("popup-register-close").onclick=function(a){u();p.System.emit("popup.closed",{type:"register"})};var b=document.getElementById("popup-register-close-button");b&&(b.onclick=function(a){u();p.System.emit("popup.closed",{type:"register"})});if(b=document.getElementById("popup-register-email-taken-login"))b.onclick=function(b){g.preventDefault(b);g.trigger(a.alreadyUserLinkEl,"click")};a.registerButtonEl&&(a.registerButtonEl.onclick=function(b){g.preventDefault(b);
if("undefined"==typeof a.registerButtonEl.enabled||a.registerButtonEl.enabled)t.validateAll(),0===h.getAll(".hinted.wrong").length&&0===h.getAll(".hinted-container.wrong").length&&(b=!0,a.subscribeConfirmationEl&&(b=a.subscribeConfirmationEl.checked?!0:!1),n("api.account.register",{username:a.usernameEl.value,email:a.emailEl.value,password:a.passwordEl.value,gender:a.genderBoyEl.checked?"m":"f",dateOfBirth:{year:parseInt(a.dobYearEl.value,10),month:parseInt(a.dobMonthEl.value,10),day:parseInt(a.dobDayEl.value,
10)},subscribe:b},function(b){!b.error&&b.auth&&b.auth.token?(u(),p.System.emit("popup.register.feedback",{type:"register",username:a.usernameEl.value})):z(!0)}),z(!1))})},O=function(){if(a.dobDayEl)for(var b=1;32>b;b++){var c=document.createElement("option");c.value=b;c.innerHTML=b;a.dobDayEl.appendChild(c)}if(a.dobYearEl)for(b=c=(new Date).getFullYear();b>c-101;b--){var d=document.createElement("option");d.value=b;d.innerHTML=b;a.dobYearEl.appendChild(d)}},P=function(b,c){var d=(b.target||b.srcElement).getAttribute("full-suggestion");
null!=d&&(a.emailEl.value=d,a.emailEl.focus(),"function"===typeof c&&c.call())},G=function(a){u();p.System.emit("popup.oauth.open",{provider:a})},Q=function(){var a=y.getItem("registrationLocked"),c=!!a;c&&(y.setItem({key:"registrationLocked",value:a}),w=!0,F(a));return c},F=function(b){b&&(b=b.split("."),a.dobDayEl.value=b[0],a.dobMonthEl.value=b[1],a.dobYearEl.value=b[2]);a.dobDayEl.setAttribute("disabled","true");a.dobMonthEl.setAttribute("disabled","true");a.dobYearEl.setAttribute("disabled",
"true");b=h.get(a.selectors.popup);e.addClass(b,"coppa-denied");h.get("#popup-register-button").style.display="none";e.addClass(a.dobEl,"coppa-wrong")},I=function(){A||(A=!0,a||(a={passwordEl:f("popup-register-password"),genderEl:f("popup-register-gender"),genderBoyEl:f("popup-register-gender-boy"),emailEl:f("popup-register-email"),genderGirlEl:f("popup-register-gender-girl"),usernameEl:f("popup-register-username"),dobEl:f("popup-register-dob"),dobDayEl:f("popup-register-dob-day"),dobMonthEl:f("popup-register-dob-month"),
dobYearEl:f("popup-register-dob-year"),awtConfirmationEl:f("popup-register-agree-with-terms-element"),subscribeConfirmationEl:f("popup-register-subscribe-element"),popupRegisterEl:f("wdg_popup_register"),alreadyUserLinkEl:f("register-alreadyuser"),registerButtonEl:f("popup-register-button"),gameidEl:f("popup-register-gameid"),hintedContainers:h.getAll("#wdg_popup_register .hinted-container"),selectors:{popup:"#wdg_popup_register",hintedContainers:".hinted-container",tipSign:".tip-sign",tip:".tip"}}),
J(),N(),O(),(C="true"===h.get(a.selectors.popup).getAttribute("data-coppa-enabled"))&&Q(),L(),M(),x.init("popup-register-username"),x.init("popup-register-email"),x.init("popup-register-password"),m["username-taken"]&&(m["username-taken"].applyExtraData=function(b){for(var c=h.get(".alternative-usernames",this);c.hasChildNodes();)c.removeChild(c.lastChild);for(var d=0;d<b.suggestionList.length;d++){var e=b.suggestionList[d];0<d&&c.appendChild(document.createTextNode(", "));var f=document.createElement("a");
f.setAttribute("href","#");f.innerHTML=e;f.onclick=function(b){return function(){a.usernameEl.value=b;g.trigger(a.usernameEl,"change")}}(e);c.appendChild(f)}}),k.email&&(k.email=function(a){if(a.suggestionList&&0<a.suggestionList.length){for(var c=document.getElementById("popup-register-email-extradata"),d=c.getAttribute("base-text"),f=c.getAttribute("list-separator"),e=" ",g=0;g<a.suggestionList.length&&2>g;g++){0<g&&(e+=f);var h=a.suggestionList[g],m=h.split("@"),e=e+('<a href="#" full-suggestion="'+
h+'"> ...@'+m[1]+"</a>")}c.innerHTML=d+(e+"?");c.style.display="block";c.onclick=function(a){P(a||window.event,function(){k.email.reset()})}}else k.email.reset()}),k.email&&(k.email.reset=function(){var a=document.getElementById("popup-register-email-extradata");a.style.display="none";a.innerHTML=""}))};return{isOpen:function(){return B},toggleRegistrationPopup:u,toggleRegisterButton:z}}});SpilGames({waiton:"spilgames.loaded"},["PopupRegister","SWP","DOMSelect"],function(t,n,p){n.init("popup_register");n.System.init(function(h){switch(h.name){case "popup.login.open":t.isOpen()&&t.toggleRegistrationPopup(!0);break;case "popup.register.open":p.get("#popup-register-close")?t.toggleRegistrationPopup():n.Widget.refresh({show_popup_contents:!0},{callback:function(){setTimeout(function(){t.toggleRegistrationPopup()},0)}})}});n.Widget.init(function(h){switch(h.name){case "open":n.System.emit("gi.game.hide");
n.System.emit("popup.header.open");break;case "close":n.System.emit("gi.game.show"),n.System.emit("popup.header.close")}})});
